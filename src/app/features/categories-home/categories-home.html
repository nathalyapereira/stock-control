<app-toolbar-navigation></app-toolbar-navigation>
<p-confirmdialog />
<app-category-form
  [(displayModal)]="displayModal"
  [categoryEvent]="categoryEventDatas"
  (getCategoriesDatas)="getAllCategories()"
/>

<div>
  <div class="!w-full">
    <p-card styleClass="shadow-3 m-5 text-indigo-800" header="Categorias de Produtos">
      <ng-template #title
        ><div class="flex items-center justify-between gap-1">
          Produtos em Estoque
          <p-button
            icon="pi pi-plus"
            severity="success"
            pTooltip="Adicionar Categoria"
            rounded
            tooltipPosition="top"
            (onClick)="handleCategoryEvent(addCategoryAction)"
          />
        </div>
      </ng-template>
      <p-table
        #categoriesTable
        dataKey="id"
        [value]="(categoriesData$ | async) ?? []"
        selectionMode="single"
        [(selection)]="selectedCategory"
        [metaKeySelection]="metaKey"
        [paginator]="true"
        [rowHover]="true"
        [rows]="rows"
        [first]="first"
        [tableStyle]="{ 'width': '100%' }"
        [rowsPerPageOptions]="[5, 10, 20]"
        [loading]="loading"
        [globalFilterFields]="['name']"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} categorias"
        showGridlines
        stripedRows
        [scrollable]="true"
        scrollHeight="400px"
        [resizableColumns]="true"
        columnResizeMode
        [totalRecords]="totalRecords"
        [responsive]="true"
      >
        <ng-template pTemplate="header">
          <tr>
            <th id="category" pSortableColumn="name" style="width: auto">
              <div class="flex items-center gap-1">
                Nome
                <p-sortIcon field="name" />

                <p-columnFilter
                  type="text"
                  field="name"
                  placeholder="Digite o nome"
                  ariaLabel="Filtro por nome"
                  [showMatchModes]="false"
                  [showOperator]="false"
                  [showAddButton]="false"
                  display="menu"
                  filterOn="input"
                ></p-columnFilter>
              </div>
            </th>
            <th
              id="product-actions"
              alignFrozen="right"
              pFrozenColumn
              [frozen]="true"
              style="width: 10%"
            >
              Ações
            </th>
          </tr>
        </ng-template>

        <ng-template #body let-category>
          <tr>
            <td>{{ category?.name }}</td>

            <td alignFrozen="right" pFrozenColumn [frozen]="true">
              <div class="flex items-center gap-1">
                <p-button
                  icon="pi pi-pencil"
                  severity="warn"
                  pTooltip="Editar Produto"
                  rounded
                  class="p-button-rounded p-button-warning"
                  tooltipPosition="top"
                  (onClick)="handleCategoryEvent(editCategoryAction, category)"
                />
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  pTooltip="Remover Produto"
                  rounded
                  class="p-button-rounded p-button-warning"
                  tooltipPosition="top"
                  (onClick)="handleDeleteCategory(category.id, category.name)"
                />
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
